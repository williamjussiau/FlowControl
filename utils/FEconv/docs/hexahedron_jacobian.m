% sufficient condition to ensure positive Jacobian for an hexahedron
% http://www.math.udel.edu/~szhang/research/p/subtettest.pdf

P{1} = [-1,-1,-1];
P{2} = [ 1,-1,-1];
P{3} = [ 1, 1,-1];
P{4} = [-1, 1,-1];
P{5} = [-1,-1, 1];
P{6} = [ 1,-1, 1];
P{7} = [ 1, 1, 1];
P{8} = [-1, 1, 1];

P{1} = [ 0,  0,  0  ];
P{2} = [ 1,  0,  0.5];
P{3} = [ 1,  1,  0  ];
P{4} = [ 0,  1,  0.5];
P{5} = [ 0.3,0.3,2  ];
P{6} = [ 1.5,0.5,2];
P{7} = [ 2,  2, -0.1];
P{8} = [0.5, 1.5, 2];

Pc = [1 2 3 7; 2 3 4 8; 3 4 1 5; 4 1 2 6; 5 8 7 3; 8 7 6 2; 7 6 5 1; 6 5 8 4; 2 1 5 8; 4 3 7 6; ...
      1 4 8 7; 3 2 6 5; 1 2 3 5; 2 3 4 6; 3 4 1 7; 4 1 2 8; 5 8 7 1; 8 7 6 4; 7 6 5 3; 6 5 8 2; ...
      5 1 4 6; 3 7 8 2; 4 8 5 3; 2 6 7 1; 1 2 4 5; 2 3 1 6; 3 4 2 7; 4 1 3 8; 5 8 6 1; 6 5 7 2; 7 6 8 3; 8 7 5 4];

detDFT = @(a1, a2, a3, a4) dot(cross(a2-a1, a3-a1), a4-a1);

Jac = zeros(size(Pc,1),1);
for i = 1:size(Pc,1)
  Jac(i) = detDFT(P{Pc(i,1)}, P{Pc(i,2)}, P{Pc(i,3)}, P{Pc(i,4)});
end
disp([Pc Jac])